{% extends 'base.html' %}

{% block content %}

<style>
.page-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 1.4rem;
    flex-wrap: wrap;
    gap: 12px;
}
.page-header-left h4 {
    font-family: 'Syne', sans-serif;
    font-size: 1.4rem;
    font-weight: 800;
    color: #0f172a;
    margin: 0;
    letter-spacing: -0.5px;
}
.page-header-left p {
    font-size: 0.82rem;
    color: #94a3b8;
    margin: 2px 0 0;
}

.filter-card {
    background: #ffffff;
    border-radius: 16px !important;
    border: 1px solid #f1f5f9 !important;
    box-shadow: 0 2px 8px rgba(0,0,0,0.05) !important;
    padding: 1.1rem 1.4rem;
    margin-bottom: 1.4rem;
    animation: fadeSlideUp 0.4s ease both;
}

@keyframes fadeSlideUp {
    from { opacity:0; transform:translateY(16px); }
    to   { opacity:1; transform:translateY(0); }
}

.filter-card .form-label {
    font-size: 0.72rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.8px;
    color: #94a3b8;
    margin-bottom: 5px;
}

.filter-card input[type="date"] {
    border: 1.5px solid #e5e7eb;
    border-radius: 10px;
    padding: 8px 12px;
    font-size: 0.85rem;
    color: #374151;
    outline: none;
    transition: border-color 0.2s, box-shadow 0.2s;
    width: 100%;
}
.filter-card input[type="date"]:focus {
    border-color: #3b82f6;
    box-shadow: 0 0 0 3px rgba(59,130,246,0.12);
}

.revenue-total-badge {
    background: linear-gradient(135deg, #059669, #10b981);
    color: #fff;
    padding: 10px 20px;
    border-radius: 12px;
    font-family: 'Syne', sans-serif;
    font-size: 1rem;
    font-weight: 700;
    box-shadow: 0 4px 14px rgba(5,150,105,0.3);
    white-space: nowrap;
}

.sales-table-card {
    background: #ffffff;
    border-radius: 16px !important;
    border: 1px solid #f1f5f9 !important;
    box-shadow: 0 2px 8px rgba(0,0,0,0.05) !important;
    overflow: hidden;
    animation: fadeSlideUp 0.5s ease 0.1s both;
}

.sales-table-card thead th {
    background: #0f172a;
    color: rgba(255,255,255,0.7);
    font-size: 0.68rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.9px;
    padding: 13px 16px;
    border: none;
    white-space: nowrap;
}

.sales-table-card tbody tr {
    border-bottom: 1px solid #f8fafc;
    transition: background 0.15s;
    animation: rowIn 0.35s ease both;
}

@keyframes rowIn {
    from { opacity:0; transform:translateX(-8px); }
    to   { opacity:1; transform:translateX(0); }
}

{% for i in "12345678910" %}
.sales-table-card tbody tr:nth-child({{ forloop.counter }}) { animation-delay: {{ forloop.counter }}00ms; }
{% endfor %}

.sales-table-card tbody tr:hover td { background: #f8fafc; }
.sales-table-card tbody tr:last-child { border-bottom: none; }

.sales-table-card tbody td {
    padding: 13px 16px;
    font-size: 0.85rem;
    color: #374151;
    vertical-align: middle;
    border: none;
}

.row-num {
    width: 32px; height: 32px;
    background: #f1f5f9;
    color: #64748b;
    border-radius: 8px;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    font-size: 0.75rem;
    font-weight: 700;
}

.product-name {
    font-weight: 600;
    color: #0f172a;
    font-size: 0.875rem;
}

.cat-pill {
    display: inline-flex;
    align-items: center;
    gap: 5px;
    padding: 4px 10px;
    border-radius: 20px;
    font-size: 0.72rem;
    font-weight: 600;
    white-space: nowrap;
}
.cat-electronics { background: #eff6ff; color: #1d4ed8; }
.cat-clothing     { background: #fdf4ff; color: #7e22ce; }
.cat-food         { background: #fff7ed; color: #c2410c; }
.cat-stationery   { background: #f0fdf4; color: #15803d; }
.cat-home         { background: #f0f9ff; color: #0369a1; }
.cat-default      { background: #f8fafc; color: #475569; }

.qty-badge {
    background: #f0f9ff;
    color: #0369a1;
    padding: 4px 10px;
    border-radius: 8px;
    font-weight: 700;
    font-size: 0.82rem;
    display: inline-block;
}

.price-cell { color: #475569; font-size: 0.85rem; }
.revenue-cell {
    font-family: 'Syne', sans-serif;
    font-size: 0.92rem;
    font-weight: 700;
    color: #059669;
}

.date-cell {
    font-size: 0.78rem;
    color: #64748b;
    white-space: nowrap;
}
.date-cell .date-main { font-weight: 600; color: #374151; }
.date-cell .date-time { color: #94a3b8; font-size: 0.72rem; }


.notes-cell { font-size: 0.78rem; color: #94a3b8; font-style: italic; }

.empty-state {
    text-align: center;
    padding: 56px 20px;
    color: #94a3b8;
}
.empty-state i { font-size: 3rem; opacity: 0.25; display: block; margin-bottom: 12px; }
.empty-state p { font-size: 0.88rem; margin: 0; }
</style>

<div class="page-header">
    <div class="page-header-left">
        <h4>&#128203; Sales History</h4>
        <p>All recorded sales transactions</p>
    </div>
    <a href="{% url 'record_sale' %}" class="btn btn-success px-4"
       style="border-radius:12px;font-weight:600;box-shadow:0 4px 12px rgba(5,150,105,0.3);">
        <i class="bi bi-cart-plus me-2"></i>New Sale
    </a>
</div>

<div class="filter-card">
    <form method="get">
        <div class="row g-3 align-items-end">
            <div class="col-md-3">
                <label class="form-label">From Date</label>
                {{ form.start_date }}
            </div>
            <div class="col-md-3">
                <label class="form-label">To Date</label>
                {{ form.end_date }}
            </div>
            <div class="col-md-3 d-flex gap-2">
                <button type="submit" class="btn btn-primary px-4" style="border-radius:10px;font-weight:600;">
                    <i class="bi bi-funnel me-1"></i>Filter
                </button>
                <a href="{% url 'sale_history' %}" class="btn px-4"
                   style="border-radius:10px;background:#f1f5f9;color:#374151;font-weight:600;border:none;">
                    Reset
                </a>
            </div>
            <div class="col-md-3 d-flex justify-content-end align-items-center">
                <div class="revenue-total-badge">
                    <i class="bi bi-currency-rupee"></i>
                    Total: &#8377;{{ total_revenue|floatformat:0 }}
                </div>
            </div>
        </div>
    </form>
</div>

<div class="sales-table-card">
    <div class="table-responsive">
        <table class="table mb-0">
            <thead>
                <tr>
                    <th>#</th>
                    <th>Product</th>
                    <th>Category</th>
                    <th class="text-center">Qty Sold</th>
                    <th>Price / Unit</th>
                    <th>Revenue</th>
                    <th>Date & Time</th>
                    <th>Notes</th>
                </tr>
            </thead>
            <tbody>
                {% for sale in sales %}
                <tr>
                    
                    <td><span class="row-num">{{ forloop.counter }}</span></td>

                    
                    <td><span class="product-name">{{ sale.product.name }}</span></td>

                    
                    <td>
                        {% if sale.product.category %}
                        {% with cat=sale.product.category.name %}
                        {% if cat == "Electronics" %}
                            <span class="cat-pill cat-electronics"><i class="bi bi-lightning-charge-fill"></i>{{ cat }}</span>
                        {% elif cat == "Clothing" %}
                            <span class="cat-pill cat-clothing"><i class="bi bi-bag-fill"></i>{{ cat }}</span>
                        {% elif cat == "Food & Beverages" %}
                            <span class="cat-pill cat-food"><i class="bi bi-cup-hot-fill"></i>{{ cat }}</span>
                        {% elif cat == "Stationery" %}
                            <span class="cat-pill cat-stationery"><i class="bi bi-pencil-fill"></i>{{ cat }}</span>
                        {% elif cat == "Home Appliances" %}
                            <span class="cat-pill cat-home"><i class="bi bi-house-fill"></i>{{ cat }}</span>
                        {% else %}
                            <span class="cat-pill cat-default">{{ cat }}</span>
                        {% endif %}
                        {% endwith %}
                        {% else %}
                        <span class="cat-pill cat-default">—</span>
                        {% endif %}
                    </td>

                   
                    <td class="text-center">
                        <span class="qty-badge">{{ sale.quantity_sold }}</span>
                    </td>

                   
                    <td class="price-cell">&#8377;{{ sale.sale_price }}</td>

                   
                    <td>
                        <span class="revenue-cell">&#8377;{{ sale.total_revenue }}</span>
                    </td>

                    
                    <td>
                        <div class="date-cell">
                            <div class="date-main">{{ sale.sale_date|date:"d M Y" }}</div>
                            <div class="date-time">{{ sale.sale_date|date:"H:i" }}</div>
                        </div>
                    </td>

                    
                    <td>
                        {% if sale.notes %}
                        <span class="notes-cell">{{ sale.notes|truncatechars:25 }}</span>
                        {% else %}
                        <span class="notes-cell">—</span>
                        {% endif %}
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="8">
                        <div class="empty-state">
                            <i class="bi bi-receipt"></i>
                            <p>No sales records found. <a href="{% url 'record_sale' %}">Record your first sale</a></p>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

{% endblock %}
